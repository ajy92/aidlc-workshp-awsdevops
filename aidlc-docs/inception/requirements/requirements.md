# 테이블오더 서비스 - Requirements Document

## Intent Analysis

- **User Request**: 테이블오더 서비스 MVP 개발. 고객이 테이블에서 QR/태블릿으로 주문하고, 사업주가 주문/메뉴를 관리하는 시스템.
- **Request Type**: New Project (Greenfield)
- **Scope Estimate**: System-wide (프론트엔드 2개 앱 + 백엔드 API + DB)
- **Complexity Estimate**: Moderate (다수 기능이 있으나 명확한 요구사항 문서 존재)
- **Source Documents**: `requirements/table-order-requirements.md`, `requirements/constraints.md`

---

## Tech Stack Decisions

| 영역 | 선택 |
|---|---|
| Backend | Node.js + Next.js API Routes |
| Frontend | Next.js (React 기반 풀스택) × 2 apps |
| Database | PostgreSQL (Supabase) |
| 실시간 통신 | SSE (Server-Sent Events) |
| 인증 | JWT (bcrypt 해싱) |
| 언어 | TypeScript |
| 배포 | Vercel (customer-app, admin-app 각각 배포) |
| DB 호스팅 | Supabase (managed PostgreSQL) |

## Architecture Decisions

- **고객용/관리자용 앱 분리**: 별도의 Next.js 앱 2개 (customer-app, admin-app)
- **SSE 적용 범위**: 관리자 주문 모니터링 + 고객 주문 상태 업데이트 모두 적용
- **데모 데이터**: 포함 (데모 매장, 샘플 메뉴, 테이블 5개)
- **메뉴 관리**: MVP에 포함

---

## Functional Requirements

### FR-1: 고객용 기능 (Customer App)

#### FR-1.1: 테이블 태블릿 자동 로그인 및 세션 관리
- 초기 설정: 매장 식별자, 테이블 번호, 비밀번호 입력 (관리자 1회 수행)
- 로그인 성공 후 정보를 로컬 저장하여 자동 로그인
- 16시간 세션 유지 (JWT)

#### FR-1.2: 메뉴 조회 및 탐색
- 메뉴 화면이 기본 화면
- 카테고리별 메뉴 분류 및 표시
- **카테고리 필터**: 메인메뉴, 사이드 메뉴, 음료, BEST, 할인 — 탭 형태로 빠른 전환
- **카테고리**: 메뉴당 1개 지정 (메인메뉴 / 사이드 메뉴 / 음료)
- **BEST / 할인**: 별도 플래그로 관리 (is_best, is_discount). BEST/할인 탭 선택 시 해당 플래그가 켜진 메뉴만 필터링
- 메뉴 상세: 메뉴명, 가격, 설명, 이미지
- **판매중(ON_SALE) 상태인 메뉴만 고객 화면에 노출**
- 카드 형태 레이아웃, 터치 친화적 버튼 (최소 44×44px)

#### FR-1.3: 장바구니 관리
- 메뉴 추가/삭제, 수량 조절
- 총 금액 실시간 계산
- 장바구니 비우기
- 로컬 저장 (페이지 새로고침 시 유지)
- 서버 전송은 주문 확정 시에만

#### FR-1.4: 주문 생성
- 주문 내역 최종 확인 → 주문 확정
- 성공 시: 주문 번호 표시, 장바구니 비우기, 5초 후 메뉴 화면 자동 리다이렉트
- 실패 시: 에러 메시지 표시, 장바구니 유지
- 주문 정보: 매장 ID, 테이블 번호, 메뉴 목록(메뉴명, 수량, 단가), 총 금액, 세션 ID

#### FR-1.5: 주문 내역 조회
- 주문 시간 순 정렬
- 주문별: 주문 번호, 시각, 메뉴/수량, 금액, 상태(대기중/준비중/완료)
- 현재 테이블 세션 주문만 표시
- **SSE로 주문 상태 실시간 업데이트**

### FR-2: 관리자용 기능 (Admin App)

#### FR-2.1: 매장 인증
- 매장 식별자 + 사용자명 + 비밀번호
- 16시간 세션 (JWT), 브라우저 새로고침 시 유지
- bcrypt 해싱, 로그인 시도 제한

#### FR-2.2: 실시간 주문 모니터링
- **SSE 기반 실시간 업데이트** (2초 이내 표시)
- 그리드/대시보드: 테이블별 카드, 총 주문액, 최신 주문 미리보기
- 주문 카드 클릭 시 전체 메뉴 목록 상세 보기
- 주문 상태 변경 (대기중 → 준비중 → 완료)
- 신규 주문 시각적 강조 (색상/애니메이션)
- 테이블별 필터링

#### FR-2.3: 테이블 관리
- 테이블 태블릿 초기 설정 (번호, 비밀번호, 세션 생성)
- 주문 삭제 (확인 팝업, 즉시 삭제, 총 주문액 재계산)
- 테이블 이용 완료 (세션 종료, 주문 내역 → 과거 이력, 리셋)
- 과거 주문 내역 조회 (시간 역순, 날짜 필터링)

#### FR-2.4: 메뉴 관리
- 메뉴 관리 시 카테고리 지정 (메인메뉴, 사이드 메뉴, 음료) + BEST/할인 플래그 설정
- 메뉴 조회 (카테고리별)
- 메뉴 등록: 메뉴명, 가격, 설명, 카테고리, 이미지 URL, 메뉴 상태, BEST 플래그, 할인 플래그
- 메뉴 수정, 삭제
- 메뉴 노출 순서 조정
- **메뉴 상태**: `판매중(ON_SALE)` / `판매전(NOT_YET)` — 고객 화면에는 `판매중` 메뉴만 노출
- 필수 필드 검증, 가격 범위 검증

#### FR-2.5: 대시보드 (매출 데이터 & 고객 분석)
- **매출 데이터**:
  - 일별/주별/월별 매출 합계
  - 주문 건수
  - 테이블별 매출
  - 메뉴별 판매 순위
  - 시간대별 주문 분포
  - 평균 객단가
  - 카테고리별 매출 비중
  - 기간 비교 (전일/전주/전월 대비)
- **고객 분석**:
  - 고객 방문 빈도 (세션 기반)
  - 재방문율
- **UI**: 차트/그래프 시각화, 날짜 범위 필터

---

- **NFR-1**: SSE 기반 실시간 통신 (관리자 + 고객)
- **NFR-2**: JWT 인증 (16시간 만료)
- **NFR-3**: bcrypt 비밀번호 해싱
- **NFR-4**: 터치 친화적 UI (최소 44×44px 버튼)
- **NFR-5**: 장바구니 클라이언트 측 로컬 저장 (새로고침 유지)

---

## Exclusions (constraints.md 기반)

구현하지 않는 기능:
- 결제 처리, PG 연동, 영수증, 환불, 포인트/쿠폰
- OAuth, SNS 로그인, 2FA
- 이미지 리사이징, CMS, 광고
- 푸시/SMS/이메일/소리 알림
- 주방 전달, 재고 관리
- ~~데이터 분석, 매출 리포트~~ → MVP에 포함으로 변경 (FR-2.5)
- 직원 관리, 예약, 리뷰, 다국어
- 배달 플랫폼, POS, 소셜 미디어, 지도/번역 API 연동

---

## Demo/Seed Data

- 데모 매장 1개 (ID: `demo`, 이름: `데모 매장`)
- 관리자 계정 (username: `admin`, password: `admin123`)
- 카테고리 3개: 메인메뉴, 사이드 메뉴, 음료 (BEST/할인은 플래그로 관리)
- 샘플 메뉴 10개:
  - 메인메뉴: 김치찌개(9,000원), 된장찌개(8,000원), 불고기(13,000원, BEST), 비빔밥(10,000원)
  - 사이드 메뉴: 계란말이(5,000원), 김치전(7,000원, 할인), 떡볶이(6,000원)
  - 음료: 콜라(2,000원), 사이다(2,000원), 맥주(5,000원, BEST)
- 테이블 5개 (비밀번호: `1234`)
